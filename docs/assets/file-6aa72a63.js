import{p as v,_ as D,q as h,s as E,o as y,c as x,a as F,b as o,w as d,E as U,i as z,e as B,f as S,g as f,n as w,t as P,h as A,j as M,k as N,u as T,v as j}from"./index-6bfe3a4a.js";import{E as L,a as O}from"./el-select-0e5a57d4.js";/* empty css                   */import{E as r}from"./index-3b6acea2.js";import"./validator-833cd1d6.js";const G=t=>v.request({url:"api/file-info/add",method:"post",data:t}),H=()=>v.request({url:"/api/file-info/all",method:"get"}).then(t=>t.data.fileInfos).catch(t=>{console.error("Failed to get files:",t)}),J=t=>v.request({url:"/api/file-info/delete",method:"get",params:t}),K=(t,e)=>v.request({url:"/api/file-info/edit",method:"post",data:e}),C=t=>v.request({url:`/api/file-info/one/${t}`,method:"get"}),Q=t=>v.request({url:`/api/file-info/folder/${t}`,method:"get"}),q=t=>v.request({url:"/api/upload/file",method:"post",data:t});const R={data(){return{selectedFile:null}},methods:{handleFileChange(t){this.selectedFile=t.target.files[0],console.log("选择的文件信息：",this.selectedFile),this.file.size=this.selectedFile.size,this.file.name=this.selectedFile.name},uploadFile(){if(this.selectedFile){const t=new FormData;t.append("file",this.selectedFile),q(t).then(e=>{console.log("文件上传成功：",e.data),this.file.url=e.data.filePath}).catch(e=>{console.error("文件上传失败：",e)})}else console.error("请选择要上传的文件")},isPreviewable(t){const e=t.name.split(".").pop().toLowerCase();return e==="jpg"||e==="pdf"}},setup(){const t=h([]),e=h(""),b=h(!1);h(null);const l=h({description:"",folderId:"",id:0,name:"",size:"",type:"",url:""});h(null),h(null);const k=()=>{l.value={description:"",folderId:"",id:"",name:"",size:"",type:"",url:""},b.value=!0},m=i=>new Promise((g,I)=>{C(i).then(a=>{console.log(a.data.fileInfo),l.value=a.data.fileInfo,b.value=!0,g()}).catch(a=>{console.error("获取文件失败：",a,a.response),I(a)})}),n=i=>{J({id:i}).then(()=>{r.success("删除文件成功"),p()}).catch(g=>{r.success("删除文件失败")})},u=()=>{l.value.id?K(l.value.id,l.value).then(()=>p()).then(i=>{r.success("更新文件成功"),b.value=!1,t.value=i}).catch(i=>{r.success("更新文件失败")}):G(l.value).then(()=>p()).then(i=>{r.success("添加文件成功"),b.value=!1,t.value=i}).catch(i=>{console.error("添加文件失败：",i)})},s=()=>{e.value?e.value==="918"||e.value==="919"||e.value==="915"?(console.log("搜索文件夹ID：",e.value),Q(e.value).then(i=>{console.log("搜索文件夹ID：",i.data),t.value=i.data.fileInfos,r.success("搜索文件成功")}).catch(i=>{console.error("搜索文件失败：",i),r.success("搜索文件失败")})):(console.log("搜索文件ID：",e.value),C(e.value).then(i=>{i.data&&i.data.fileInfo?(t.value=[i.data.fileInfo],r.success("搜索文件成功")):(r.success("未找到文件夹"),t.value=[])}).catch(i=>{console.error("搜索文件失败：",i),r.success("搜索文件失败")})):p()},p=()=>{H().then(i=>{t.value=i}).catch(i=>{console.error("获取文件列表失败：",i)})},c=i=>{window.open(i,"_blank")},_=i=>{window.open(i,"_blank")};return E(p),{files:t,searchId:e,dialogVisible:b,file:l,showAddForm:k,getFileById:m,removeFile:n,saveFile:u,performSearch:s,cosUploadFile:q,downloadFile:c,previewFile:_}}},W=t=>(T("data-v-82ca0b8c"),t=t(),j(),t),X={class:"file-info"},Y={class:"file-tools"},Z=W(()=>F("button",{type:"submit"},"上传文件",-1)),$={class:"dialog-footer"};function ee(t,e,b,l,k,m){const n=U,u=z,s=A,p=B,c=M,_=L,i=O,g=N,I=S;return y(),x("div",X,[F("div",Y,[o(n,{type:"warning",onClick:l.showAddForm},{default:d(()=>[f("添加文件")]),_:1},8,["onClick"]),o(u,{modelValue:l.searchId,"onUpdate:modelValue":e[0]||(e[0]=a=>l.searchId=a),placeholder:"请输入文件ID或文件夹ID",clearable:"",style:{width:"200px"}},null,8,["modelValue"]),o(n,{type:"primary",onClick:l.performSearch},{default:d(()=>[f("查询")]),_:1},8,["onClick"])]),o(p,{data:l.files,style:{width:"100%"},class:"file-table"},{default:d(()=>[o(s,{prop:"id",label:"ID",width:"80"}),o(s,{prop:"name",label:"文件名称"}),o(s,{prop:"size",label:"文件大小"}),o(s,{prop:"type",label:"文件类型"}),o(s,{prop:"description",label:"文件描述"}),o(s,{prop:"folderId",label:"文件夹ID"}),o(s,{prop:"url",label:"网址"}),o(s,{fixed:"right",label:"操作",width:"150"},{default:d(({row:a})=>[o(n,{type:"primary",onClick:V=>l.getFileById(a.id),class:"file-edit-btn"},{default:d(()=>[f("修改")]),_:2},1032,["onClick"]),o(n,{type:"danger",onClick:V=>l.removeFile(a.id),class:"file-delete-btn"},{default:d(()=>[f("删除")]),_:2},1032,["onClick"]),m.isPreviewable(a)?(y(),w(n,{key:0,type:"success",onClick:V=>l.previewFile(a.url),class:"file-preview-btn"},{default:d(()=>[f("预览")]),_:2},1032,["onClick"])):(y(),w(n,{key:1,type:"success",onClick:V=>l.downloadFile(a.url),class:"file-download-btn"},{default:d(()=>[f("下载")]),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"]),o(I,{modelValue:l.dialogVisible,"onUpdate:modelValue":e[11]||(e[11]=a=>l.dialogVisible=a),title:"文件编辑","close-on-click-modal":!1},{footer:d(()=>[F("span",$,[o(n,{onClick:e[10]||(e[10]=a=>l.dialogVisible=!1)},{default:d(()=>[f("取消")]),_:1}),o(n,{type:"primary",onClick:l.saveFile},{default:d(()=>[f("保存")]),_:1},8,["onClick"])])]),default:d(()=>[o(g,{model:l.file,ref:"fileForm","label-width":"80px"},{default:d(()=>[o(c,{label:"ID",required:""},{default:d(()=>[o(u,{modelValue:l.file.id,"onUpdate:modelValue":e[1]||(e[1]=a=>l.file.id=a),autocomplete:"off",readonly:"",placeholder:l.file.id===""?"自动生成ID,无需编辑":""},null,8,["modelValue","placeholder"])]),_:1}),o(c,{label:"文件名称",required:""},{default:d(()=>[o(u,{modelValue:l.file.name,"onUpdate:modelValue":e[2]||(e[2]=a=>l.file.name=a),autocomplete:"off",readonly:"",placeholder:l.file.name===""?"上传文件自动识别名称,无需编辑":""},null,8,["modelValue","placeholder"])]),_:1}),o(c,{label:"文件大小",required:""},{default:d(()=>[o(u,{modelValue:l.file.size,"onUpdate:modelValue":e[3]||(e[3]=a=>l.file.size=a),autocomplete:"off",readonly:"",placeholder:l.file.size===""?"上传文件自动识别文件大小,无需编辑":""},null,8,["modelValue","placeholder"])]),_:1}),o(c,{label:"文件类型",required:""},{default:d(()=>[o(i,{modelValue:l.file.type,"onUpdate:modelValue":e[4]||(e[4]=a=>l.file.type=a),placeholder:"请选择文件类型"},{default:d(()=>[o(_,{label:"0：图片",value:"0"}),o(_,{label:"1：视频或文件",value:"1"})]),_:1},8,["modelValue"])]),_:1}),o(c,{label:"文件描述",required:""},{default:d(()=>[o(u,{modelValue:l.file.description,"onUpdate:modelValue":e[5]||(e[5]=a=>l.file.description=a),autocomplete:"off",placeholder:"请简略描述文件"},null,8,["modelValue"])]),_:1}),o(c,{label:"文件夹ID",required:""},{default:d(()=>[o(i,{modelValue:l.file.folderId,"onUpdate:modelValue":e[6]||(e[6]=a=>l.file.folderId=a),placeholder:"请选择存入的文件夹"},{default:d(()=>[o(_,{label:"图片",value:"918"}),o(_,{label:"文档",value:"919"}),o(_,{label:"PDF",value:"915"})]),_:1},8,["modelValue"])]),_:1}),o(c,{label:"网址",required:""},{default:d(()=>[o(u,{modelValue:l.file.url,"onUpdate:modelValue":e[7]||(e[7]=a=>l.file.url=a),autocomplete:"off",readonly:"",placeholder:l.file.url===""?"点击上传文件自动识别url,无需编辑":""},null,8,["modelValue","placeholder"])]),_:1}),F("form",{onSubmit:e[9]||(e[9]=P((...a)=>m.uploadFile&&m.uploadFile(...a),["prevent"]))},[F("input",{type:"file",ref:"fileInput",onChange:e[8]||(e[8]=(...a)=>m.handleFileChange&&m.handleFileChange(...a))},null,544),Z],32)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}const de=D(R,[["render",ee],["__scopeId","data-v-82ca0b8c"]]);export{de as default};
